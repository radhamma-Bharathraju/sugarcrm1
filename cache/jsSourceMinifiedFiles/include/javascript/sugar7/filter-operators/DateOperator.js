(function register(app){app.events.on('app:init',function init(){function DateOperator(def){this.def=def;}
DateOperator.prototype.getUpdatedInput=function(callback){if(this.def._qualifierName==='between_dates'){callback(this.updateBetweenDatesFilterData());}else if(this.def._qualifierName==='between_datetimes'){callback(this.updateBetweenDatetimesFilterData());}else if(this.def._qualifierName.indexOf('_n_days')!=-1){callback(this.updateNthDays());}else if(_.contains(['date','datetime'],this.def._fieldType)){callback(this.updateDatetimeFilterData());}else if(this.def._fieldType==='datetimecombo'){callback(this.updateDatetimecomboFilterData());}
return{};};DateOperator.prototype.updateBetweenDatesFilterData=function(){return{properties:{_inputType:'date-between',_inputValue:this.toDisplayDate(this.def._filterData.input_name0),_inputValue1:this.toDisplayDate(this.def._filterData.input_name1),},};};DateOperator.prototype.updateBetweenDatetimesFilterData=function(){return{properties:{_inputType:'datetime-between',_inputValue:this.toDisplayDate(this.def._filterData.input_name0),_inputValue1:this.def._filterData.input_name1,_inputValue2:this.toDisplayDate(this.def._filterData.input_name2),_inputValue3:this.def._filterData.input_name3,},};},DateOperator.prototype.updateNthDays=function(){return{properties:{_inputType:'text',_inputValue:this.def._filterData.input_name0,},};},DateOperator.prototype.updateDatetimeFilterData=function(){return this.getDatetimeFilterData(this.def._qualifierName,'date',false);},DateOperator.prototype.updateDatetimecomboFilterData=function(){return this.getDatetimeFilterData(this.def._qualifierName,'datetimecombo',true);},DateOperator.prototype.getDatetimeFilterData=function(qualifierName,dateType,useTime){if(qualifierName.indexOf('tp_')===0){return{properties:{_inputType:'empty',},};}else{const updatedInputs={_inputType:dateType,_inputValue:this.toDisplayDate(this.def._filterData.input_name0),};if(useTime){updatedInputs._inputValue1=this.def._filterData.input_name1;}
return{properties:updatedInputs,};}},DateOperator.prototype.toDisplayDate=function(filterDate){let dateFragments=filterDate.match(/([0-9]{4})-([0-9]{1,2})-([0-9]{1,2})/);const yearIdx=1;const monthIdx=2;const dayIdx=3;if(!dateFragments){return filterDate;}
let displayDate=app.user.getPreference('datepref');displayDate=displayDate.replace('Y',dateFragments[yearIdx]);displayDate=displayDate.replace('m',dateFragments[monthIdx]);displayDate=displayDate.replace('d',dateFragments[dayIdx]);return displayDate;},app.filterOperators=app.filterOperators||{};app.filterOperators=_.extend(app.filterOperators,{DateOperator:DateOperator});});})(SUGAR.App);